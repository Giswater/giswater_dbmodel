/*
This file is part of Giswater
The program is free software: you can redistribute it and/or modify it under the terms of the GNU
General Public License as published by the Free Software Foundation, either version 3 of the License,
or (at your option) any later version.
*/
BEGIN;

-- Suppress NOTICE messages
SET client_min_messages TO WARNING;

SET search_path = "SCHEMA_NAME", public, pg_catalog;

SELECT plan(30);

-- arc -> conduit
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_chamber
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, max_volume, util_volume, inlet, bottom_channel, accessibility, "name", bottom_mat, slope, chamber_param_1, chamber_param_2, dwfzone_outfall, drainzone_outfall)
VALUES('-901', '-901', '-901', 33.300, NULL, 33.300, NULL, NULL, NULL, NULL, NULL, 'CHAMBER', 'CHAMBER', 'CHAMBER-01', NULL, 'STORAGE', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418456.38290275045 4577986.547739702)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:02.000', 'postgres', '2024-08-23 12:00:02.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'STORAGE', 0.000, 0.000, NULL, NULL, NULL, NULL, false, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
INSERT INTO ve_node_chamber
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, max_volume, util_volume, inlet, bottom_channel, accessibility, "name", bottom_mat, slope, chamber_param_1, chamber_param_2, dwfzone_outfall, drainzone_outfall)
VALUES('-902', '-902', '-902', 33.180, NULL, 33.180, NULL, NULL, NULL, NULL, NULL, 'CHAMBER', 'CHAMBER', 'CHAMBER-01', NULL, 'STORAGE', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418459.7520876639 4577987.378497627)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:10.000', 'postgres', '2024-08-23 12:00:10.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'STORAGE', 0.000, 0.000, NULL, NULL, NULL, NULL, false, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);

INSERT INTO ve_arc_conduit
(arc_id, code, sys_code, node_1, nodetype_1, y1, elev1, custom_elev1, sys_elev1, sys_y1, r1, z1, node_2, nodetype_2, y2, elev2, custom_elev2, sys_elev2, sys_y2, r2, z2, slope, arc_type, sys_type, arccat_id, matcat_id, cat_shape, cat_geom1, cat_geom2, cat_width, cat_area, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, gis_length, custom_length, inverted_slope, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, workcat_id_plan, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, link, verified, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, num_value, asset_id, pavcat_id, parent_id, is_operative, adate, adescript, visitability, created_at, created_by, updated_at, updated_by, the_geom, inp_type, bottom_mat, dwfzone_outfall, drainzone_outfall)
VALUES('-901', '-901', '-901', '-901', 'CHAMBER', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '-902', 'CHAMBER', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'CONDUIT', 'CONDUIT', 'CC100', NULL, 'CIRCULAR', 1.0000, 0.0000, 1.30, 0.7854, 'CONDUIT', 1, 2, 2, 1, 2, 2, NULL, NULL, 3.47, NULL, false, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, '', '1', NULL, NULL, NULL, NULL, true, true, false, NULL, NULL, 'Asphalt', NULL, true, NULL, NULL, 1,'2024-08-23 12:05:37.000', 'postgres', '2024-08-23 12:05:37.000', 'postgres', 'SRID=25831;LINESTRING (418456.38290275045 4577986.547739702, 418459.7520876639 4577987.378497627)'::public.geometry, 'CONDUIT', NULL, NULL, NULL);
SELECT is((SELECT count(*)::integer FROM ve_arc_conduit WHERE code = '-901'), 1, 'INSERT: ve_arc_conduit "-901" was inserted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-901'), 1, 'INSERT: arc "-901" was inserted');

UPDATE ve_arc_conduit SET y1 = 1.50 WHERE code = '-901';
SELECT is((SELECT y1 FROM ve_arc_conduit WHERE code = '-901'), 1.50, 'UPDATE: ve_arc_conduit "-901" was updated');
SELECT is((SELECT y1 FROM arc WHERE code = '-901'), 1.50, 'UPDATE: arc "-901" was updated');

DELETE FROM ve_arc_conduit WHERE code = '-901';
SELECT is((SELECT count(*)::integer FROM ve_arc_conduit WHERE code = '-901'), 0, 'DELETE: ve_arc_conduit "-901" was deleted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-901'), 0, 'DELETE: arc "-901" was deleted');


-- arc -> pump_pipe
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_change
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, dwfzone_outfall, drainzone_outfall)
VALUES('-903', '-903', '-903', 33.300, NULL, 33.300, NULL, NULL, NULL, NULL, NULL, 'CHANGE', 'JUNCTION', 'CHANGE_1', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418456.8905881484 4577984.332385239)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:22.000', 'postgres', '2024-08-23 12:00:22.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', NULL, NULL);
INSERT INTO ve_node_change
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, dwfzone_outfall, drainzone_outfall)
VALUES('-904', '-904', '-904', 33.180, NULL, 33.180, NULL, NULL, NULL, NULL, NULL, 'CHANGE', 'JUNCTION', 'CHANGE_1', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418460.25977306184 4577985.047760118)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:30.000', 'postgres', '2024-08-23 12:00:30.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', NULL, NULL);

INSERT INTO ve_arc_pump_pipe
(arc_id, code, sys_code, node_1, nodetype_1, y1, elev1, custom_elev1, sys_elev1, sys_y1, r1, z1, node_2, nodetype_2, y2, elev2, custom_elev2, sys_elev2, sys_y2, r2, z2, slope, arc_type, sys_type, arccat_id, matcat_id, cat_shape, cat_geom1, cat_geom2, cat_width, cat_area, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, gis_length, custom_length, inverted_slope, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, workcat_id_plan, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, link, verified, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, num_value, asset_id, pavcat_id, parent_id, is_operative, adate, adescript, visitability, created_at, created_by, updated_at, updated_by, the_geom, inp_type, bottom_mat, pumpipe_param_1, pumpipe_param_2, dwfzone_outfall, drainzone_outfall)
VALUES('-902', '-902', '-902', '-903', 'CHANGE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '-904', 'CHANGE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'PUMP_PIPE', 'CONDUIT', 'PP030', NULL, 'FORCE_MAIN', 0.1800, 100.0000, 0.26, 0.0314, 'CONDUIT', 1, 2, 2, 1, 2, 2, NULL, NULL, 3.44, NULL, false, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, '', '1', NULL, NULL, NULL, NULL, true, true, false, NULL, NULL, 'Asphalt', NULL, true, NULL, NULL, 1, '2024-08-23 12:09:24.000', 'postgres', '2024-08-23 12:09:24.000', 'postgres', 'SRID=25831;LINESTRING (418456.8905881484 4577984.332385239, 418460.25977306184 4577985.047760118)'::public.geometry, 'CONDUIT', NULL, false, NULL, NULL, NULL);
SELECT is((SELECT count(*)::integer FROM ve_arc_pump_pipe WHERE code = '-902'), 1, 'INSERT: ve_arc_pump_pipe "-902" was inserted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-902'), 1, 'INSERT: arc "-902" was inserted');

UPDATE ve_arc_pump_pipe SET y1 = 0.20 WHERE code = '-902';
SELECT is((SELECT y1 FROM ve_arc_pump_pipe WHERE code = '-902'), 0.20, 'UPDATE: ve_arc_pump_pipe "-902" was updated');
SELECT is((SELECT y1 FROM arc WHERE code = '-902'), 0.20, 'UPDATE: arc "-902" was updated');

DELETE FROM ve_arc_pump_pipe WHERE code = '-902';
SELECT is((SELECT count(*)::integer FROM ve_arc_pump_pipe WHERE code = '-902'), 0, 'DELETE: ve_arc_pump_pipe "-902" was deleted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-902'), 0, 'DELETE: arc "-902" was deleted');


-- arc -> circ_manhole
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_circ_manhole
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, prot_surface, inlet, bottom_channel, accessibility, bottom_mat, cirmanhole_param_1, cirmanhole_param_2, dwfzone_outfall, drainzone_outfall)
VALUES('-905', '-905', '-905', 33.280, NULL, 33.280, NULL, NULL, NULL, NULL, NULL, 'CIRC_MANHOLE', 'MANHOLE', 'C_MANHOLE_100', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418457.2828905013 4577982.440103301)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:43.000', 'postgres', '2024-08-23 12:00:43.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', 0.000, 0.000, NULL, false, NULL, false, NULL, NULL, NULL, NULL, NULL, NULL);
INSERT INTO ve_node_circ_manhole
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, prot_surface, inlet, bottom_channel, accessibility, bottom_mat, cirmanhole_param_1, cirmanhole_param_2, dwfzone_outfall, drainzone_outfall)
VALUES('-906', '-906', '-906', 33.180, NULL, 33.180, NULL, NULL, NULL, NULL, NULL, 'CIRC_MANHOLE', 'MANHOLE', 'C_MANHOLE_100', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418460.72130524175 4577983.040095135)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:53.000', 'postgres', '2024-08-23 12:00:53.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', 0.000, 0.000, NULL, false, NULL, false, NULL, NULL, NULL, NULL, NULL, NULL);

INSERT INTO ve_arc_siphon
(arc_id, code, sys_code, node_1, nodetype_1, y1, elev1, custom_elev1, sys_elev1, sys_y1, r1, z1, node_2, nodetype_2, y2, elev2, custom_elev2, sys_elev2, sys_y2, r2, z2, slope, arc_type, sys_type, arccat_id, matcat_id, cat_shape, cat_geom1, cat_geom2, cat_width, cat_area, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, gis_length, custom_length, inverted_slope, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, workcat_id_plan, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, link, verified, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, num_value, asset_id, pavcat_id, parent_id, is_operative, adate, adescript, visitability, created_at, created_by, updated_at, updated_by, the_geom, inp_type, "name", dwfzone_outfall, drainzone_outfall)
VALUES('-903', '-903', '-903', '-905', 'CIRC_MANHOLE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '-906', 'CIRC_MANHOLE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'SIPHON', 'SIPHON', 'SIPHON-CC100', NULL, 'CIRCULAR', 1.0000, 0.0000, 1.30, 0.7854, 'CONDUIT', 1, 2, 2, 1, 2, 2, NULL, NULL, 3.49, NULL, false, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, '', '1', NULL, NULL, NULL, NULL, true, true, false, NULL, NULL, 'Asphalt', NULL, true, NULL, 1, NULL, '2024-08-23 12:10:22.000', 'postgres', '2024-08-23 12:10:22.000', 'postgres', 'SRID=25831;LINESTRING (418457.2828905013 4577982.440103301, 418460.72130524175 4577983.040095135)'::public.geometry, 'CONDUIT', NULL, NULL,NULL);
SELECT is((SELECT count(*)::integer FROM ve_arc_siphon WHERE code = '-903'), 1, 'INSERT: ve_arc_siphon "-903" was inserted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-903'), 1, 'INSERT: arc "-903" was inserted');

UPDATE ve_arc_siphon SET y1 = 1.50 WHERE code = '-903';
SELECT is((SELECT y1 FROM ve_arc_siphon WHERE code = '-903'), 1.50, 'UPDATE: ve_arc_siphon "-903" was updated');
SELECT is((SELECT y1 FROM arc WHERE code = '-903'), 1.50, 'UPDATE: arc "-903" was updated');

DELETE FROM ve_arc_siphon WHERE code = '-903';
SELECT is((SELECT count(*)::integer FROM ve_arc_siphon WHERE code = '-903'), 0, 'DELETE: ve_arc_siphon "-903" was deleted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-903'), 0, 'DELETE: arc "-903" was deleted');


-- arc -> varc
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_highpoint
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, dwfzone_outfall, drainzone_outfall)
VALUES('-907', '-907', '-907', 33.270, NULL, 33.270, NULL, NULL, NULL, NULL, NULL, 'HIGHPOINT', 'JUNCTION', 'HIGH POINT-01', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418457.65211624536 4577980.478591539)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:01:08.000', 'postgres', '2024-08-23 12:01:08.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', NULL, NULL);
INSERT INTO ve_node_highpoint
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, dwfzone_outfall, drainzone_outfall)
VALUES('-908', '-908', '-908', 33.270, NULL, 33.270, NULL, NULL, NULL, NULL, NULL, 'HIGHPOINT', 'JUNCTION', 'HIGH POINT-01', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418461.1136075948 4577981.078583373)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:01:16.000', 'postgres', '2024-08-23 12:01:16.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', NULL, NULL);

INSERT INTO ve_arc_varc
(arc_id, code, sys_code, node_1, nodetype_1, y1, elev1, custom_elev1, sys_elev1, sys_y1, r1, z1, node_2, nodetype_2, y2, elev2, custom_elev2, sys_elev2, sys_y2, r2, z2, slope, arc_type, sys_type, arccat_id, matcat_id, cat_shape, cat_geom1, cat_geom2, cat_width, cat_area, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, gis_length, custom_length, inverted_slope, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, workcat_id_plan, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, link, verified, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, num_value, asset_id, pavcat_id, parent_id, is_operative, adate, adescript, visitability, created_at, created_by, updated_at, updated_by, the_geom, inp_type, dwfzone_outfall, drainzone_outfall)
VALUES('-904', '-904', '-904', '-907', 'HIGHPOINT', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '-908', 'HIGHPOINT', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'VARC', 'VARC', 'VIRTUAL', NULL, 'VIRTUAL', 0.0000, 0.0000, 0.00, 0.0000, 'VIRTUAL', 1, 2, 2, 1, 2, 2, NULL, NULL, 3.51, NULL, false, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, '', '1', NULL, NULL, NULL, NULL, true, true, false, NULL, NULL, 'Asphalt', NULL, true, NULL, NULL, 1, '2024-08-23 12:11:35.000', 'postgres', '2024-08-23 12:11:35.000', 'pstgres', 'SRID=25831;LINESTRING (418457.65211624536 4577980.478591539, 418461.1136075948 4577981.078583373)'::public.geometry, 'VIRTUAL', NULL, NULL);
SELECT is((SELECT count(*)::integer FROM ve_arc_varc WHERE code = '-904'), 1, 'INSERT: ve_arc_varc "-904" was inserted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-904'), 1, 'INSERT: arc "-904" was inserted');

UPDATE ve_arc_varc SET y1 = 1.50 WHERE code = '-904';
SELECT is((SELECT y1 FROM ve_arc_varc WHERE code = '-904'), 1.50, 'UPDATE: ve_arc_varc "-904" was updated');
SELECT is((SELECT y1 FROM arc WHERE code = '-904'), 1.50, 'UPDATE: arc "-904" was updated');

DELETE FROM ve_arc_varc WHERE code = '-904';
SELECT is((SELECT count(*)::integer FROM ve_arc_varc WHERE code = '-904'), 0, 'DELETE: ve_arc_varc "-904" was deleted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-904'), 0, 'DELETE: arc "-904" was deleted');


-- arc -> waccel
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_jump
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, prot_surface, accessibility, "name", dwfzone_outfall, drainzone_outfall)
VALUES('-909', '-909', '-909', 33.270, NULL, 33.270, NULL, NULL, NULL, NULL, NULL, 'JUMP', 'WJUMP', 'JUMP-01', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418458.17133994785 4577978.678616038)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:01:28.000', 'postgres', '2024-08-23 12:01:28.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', 0.000, 0.000, NULL, false, NULL, NULL, NULL, NULL);
INSERT INTO ve_node_jump
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, prot_surface, accessibility, "name", dwfzone_outfall, drainzone_outfall)
VALUES('-910', '-910', '-910', 33.270, NULL, 33.270, NULL, NULL, NULL, NULL, NULL, 'JUMP', 'WJUMP', 'JUMP-01', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418461.4828333389 4577979.197839739)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:01:40.000', 'postgres', '2024-08-23 12:01:40.000', 'postgres', NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', 0.000, 0.000, NULL, false, NULL, NULL, NULL, NULL);

INSERT INTO ve_arc_waccel
(arc_id, code, sys_code, node_1, nodetype_1, y1, elev1, custom_elev1, sys_elev1, sys_y1, r1, z1, node_2, nodetype_2, y2, elev2, custom_elev2, sys_elev2, sys_y2, r2, z2, slope, arc_type, sys_type, arccat_id, matcat_id, cat_shape, cat_geom1, cat_geom2, cat_width, cat_area, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, gis_length, custom_length, inverted_slope, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, workcat_id_plan, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, region_id, province_id, descript, link, verified, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, num_value, asset_id, pavcat_id, parent_id, is_operative, adate, adescript, visitability, created_at, created_by, updated_at, updated_by, the_geom, inp_type, sander_length, sander_depth, prot_surface, accessibility, "name", dwfzone_outfall, drainzone_outfall)
VALUES('-905', '-905', '-905', '-909', 'JUMP', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '-910', 'JUMP', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'WACCEL', 'WACCEL', 'WACCEL-CC020', NULL, 'CIRCULAR', 0.2000, 0.0000, 0.26, 0.0314, 'CONDUIT', 1, 2, 2, 1, 2, 2, NULL, NULL, 3.35, NULL, false, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, 0, NULL, 'work1', NULL, '2024-08-23', NULL, NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, '', '1', NULL, NULL, NULL, NULL, true, true, false, NULL, NULL, 'Asphalt', NULL, true, NULL, NULL, 1, '2024-08-23 12:11:49.000', 'postgres', '2024-08-23 12:11:49.000', 'postgres', 'SRID=25831;LINESTRING (418458.17133994785 4577978.678616038, 418461.4828333389 4577979.197839739)'::public.geometry, 'CONDUIT', NULL, NULL, false, NULL, NULL, NULL, NULL);
SELECT is((SELECT count(*)::integer FROM ve_arc_waccel WHERE code = '-905'), 1, 'INSERT: ve_arc_waccel "-905" was inserted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-905'), 1, 'INSERT: arc "-905" was inserted');

UPDATE ve_arc_waccel SET y1 = 0.20 WHERE code = '-905';
SELECT is((SELECT y1 FROM ve_arc_waccel WHERE code = '-905'), 0.20, 'UPDATE: ve_arc_waccel "-905" was updated');
SELECT is((SELECT y1 FROM arc WHERE code = '-905'), 0.20, 'UPDATE: arc "-905" was updated');

DELETE FROM ve_arc_waccel WHERE code = '-905';
SELECT is((SELECT count(*)::integer FROM ve_arc_waccel WHERE code = '-905'), 0, 'DELETE: ve_arc_waccel "-905" was deleted');
SELECT is((SELECT count(*)::integer FROM arc WHERE code = '-905'), 0, 'DELETE: arc "-905" was deleted');


SELECT * FROM finish();

ROLLBACK;
