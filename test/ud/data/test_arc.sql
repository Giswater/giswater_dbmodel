/*
This file is part of Giswater
The program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
This version of Giswater is provided by Giswater Association
*/
BEGIN;

-- Suppress NOTICE messages
SET client_min_messages TO WARNING;

SET search_path = "SCHEMA_NAME", public, pg_catalog;

SELECT plan(15);

-- arc -> conduit
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_chamber
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, max_volume, util_volume, inlet, bottom_channel, accessibility, "name", bottom_mat, slope, chamber_param_1, chamber_param_2)
VALUES('-901', '-901', '-901', 33.300, NULL, 33.300, NULL, NULL, NULL, NULL, NULL, NULL, 'CHAMBER', 'CHAMBER', 'CHAMBER-01', NULL, 'STORAGE', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418456.38290275045 4577986.547739702)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:02.000', 'postgres', '2024-08-23 12:00:02.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'STORAGE', 0.000, 0.000, NULL, NULL, NULL, NULL, false, NULL, NULL, NULL, NULL, NULL, NULL);
INSERT INTO ve_node_chamber
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, max_volume, util_volume, inlet, bottom_channel, accessibility, "name", bottom_mat, slope, chamber_param_1, chamber_param_2)
VALUES('-902', '-902', '-902', 33.180, NULL, 33.180, NULL, NULL, NULL, NULL, NULL, NULL, 'CHAMBER', 'CHAMBER', 'CHAMBER-01', NULL, 'STORAGE', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418459.7520876639 4577987.378497627)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:10.000', 'postgres', '2024-08-23 12:00:10.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'STORAGE', 0.000, 0.000, NULL, NULL, NULL, NULL, false, NULL, NULL, NULL, NULL, NULL, NULL);

INSERT INTO arc
(arc_id, code, sys_code, node_1, node_2, y1, y2, elev1, elev2, custom_y1, custom_y2, custom_elev1, custom_elev2, sys_elev1, sys_elev2, arc_type, arccat_id, matcat_id, epa_type, sector_id, state, state_type, annotation, observ, "comment", sys_slope, inverted_slope, custom_length, omzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, descript, link, verified, the_geom, label_x, label_y, label_rotation, publish, inventory, uncertain, expl_id, num_value, feature_type, created_at,  updated_at, updated_by, created_by, district_id, workcat_id_plan, asset_id, pavcat_id, drainzone_id, nodetype_1, node_sys_top_elev_1, node_sys_elev_1, nodetype_2, node_sys_top_elev_2, node_sys_elev_2, parent_id, expl_id2, adate, adescript, visitability)
VALUES('-901', '-901', '-901', '-901', '-902', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'CONDUIT', 'CC100', NULL, 'CONDUIT', 2, 1, 2, NULL, NULL, NULL, NULL, false, NULL, 3, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '', '1', 'SRID=25831;LINESTRING (418456.38290275045 4577986.547739702, 418459.7520876639 4577987.378497627)'::public.geometry, NULL, NULL, NULL, true, true, false, 2, NULL, 'ARC', '2024-08-23 12:05:37.421', '2024-08-23 12:05:37.505', 'postgres', 'postgres', NULL, NULL, NULL, 'Asphalt', NULL, 'CHAMBER', 33.300, NULL, 'CHAMBER', 33.180, NULL, NULL, NULL, NULL, NULL, 1);
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-901'), 1, 'INSERT: arc "-901" was inserted');

UPDATE arc SET y1 = 33.0000 WHERE arc_id = '-901';
SELECT is((SELECT y1 FROM arc WHERE arc_id = '-901'), 33.0000, 'UPDATE: arc "-901" was updated');

DELETE FROM arc WHERE arc_id = '-901';
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-901'), 0, 'DELETE: arc "-901" was deleted');


-- arc -> pump_pipe
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_change
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type)
VALUES('-903', '-903', '-903', 33.300, NULL, 33.300, NULL, NULL, NULL, NULL, NULL, NULL, 'CHANGE', 'JUNCTION', 'CHANGE_1', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418456.8905881484 4577984.332385239)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:22.000', 'postgres', '2024-08-23 12:00:22.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION');
INSERT INTO ve_node_change
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type)
VALUES('-904', '-904', '-904', 33.180, NULL, 33.180, NULL, NULL, NULL, NULL, NULL, NULL, 'CHANGE', 'JUNCTION', 'CHANGE_1', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418460.25977306184 4577985.047760118)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:30.000', 'postgres', '2024-08-23 12:00:30.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION');

INSERT INTO arc
(arc_id, code, sys_code, node_1, node_2, y1, y2, elev1, elev2, custom_y1, custom_y2, custom_elev1, custom_elev2, sys_elev1, sys_elev2, arc_type, arccat_id, matcat_id, epa_type, sector_id, state, state_type, annotation, observ, "comment", sys_slope, inverted_slope, custom_length, omzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, descript, link, verified, the_geom, label_x, label_y, label_rotation, publish, inventory, uncertain, expl_id, num_value, feature_type, created_at,  updated_at, updated_by, created_by, district_id, workcat_id_plan, asset_id, pavcat_id, drainzone_id, nodetype_1, node_sys_top_elev_1, node_sys_elev_1, nodetype_2, node_sys_top_elev_2, node_sys_elev_2, parent_id, expl_id2, adate, adescript, visitability)
VALUES('-902', '-902', '-902', '-903', '-904', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'PUMP_PIPE', 'PP030', NULL, 'CONDUIT', 2, 1, 2, NULL, NULL, NULL, NULL, false, NULL, 3, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '', '1', 'SRID=25831;LINESTRING (418456.8905881484 4577984.332385239, 418460.25977306184 4577985.047760118)'::public.geometry, NULL, NULL, NULL, true, true, false, 2, NULL, 'ARC', '2024-08-23 12:09:24.778', '2024-08-23 12:09:24.849', 'postgres', 'postgres', NULL, NULL, NULL, 'Asphalt', NULL, 'CHANGE', 33.300, NULL, 'CHANGE', 33.180, NULL, NULL, NULL, NULL, NULL, 1);
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-902'), 1, 'INSERT: arc "-902" was inserted');

UPDATE arc SET y1 = 33.0000 WHERE arc_id = '-902';
SELECT is((SELECT y1 FROM arc WHERE arc_id = '-902'), 33.0000, 'UPDATE: arc "-902" was updated');

DELETE FROM arc WHERE arc_id = '-902';
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-902'), 0, 'DELETE: arc "-902" was deleted');

-- arc -> circ_manhole
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_circ_manhole
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, prot_surface, inlet, bottom_channel, accessibility, bottom_mat, cirmanhole_param_1, cirmanhole_param_2)
VALUES('-905', '-905', '-905', 33.280, NULL, 33.280, NULL, NULL, NULL, NULL, NULL, NULL, 'CIRC_MANHOLE', 'MANHOLE', 'C_MANHOLE_100', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418457.2828905013 4577982.440103301)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:43.000', 'postgres', '2024-08-23 12:00:43.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', 0.000, 0.000, NULL, false, NULL, false, NULL, NULL, NULL, NULL);
INSERT INTO ve_node_circ_manhole
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, prot_surface, inlet, bottom_channel, accessibility, bottom_mat, cirmanhole_param_1, cirmanhole_param_2)
VALUES('-906', '-906', '-906', 33.180, NULL, 33.180, NULL, NULL, NULL, NULL, NULL, NULL, 'CIRC_MANHOLE', 'MANHOLE', 'C_MANHOLE_100', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418460.72130524175 4577983.040095135)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:00:53.000', 'postgres', '2024-08-23 12:00:53.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', 0.000, 0.000, NULL, false, NULL, false, NULL, NULL, NULL, NULL);

INSERT INTO arc
(arc_id, code, sys_code, node_1, node_2, y1, y2, elev1, elev2, custom_y1, custom_y2, custom_elev1, custom_elev2, sys_elev1, sys_elev2, arc_type, arccat_id, matcat_id, epa_type, sector_id, state, state_type, annotation, observ, "comment", sys_slope, inverted_slope, custom_length, omzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, descript, link, verified, the_geom, label_x, label_y, label_rotation, publish, inventory, uncertain, expl_id, num_value, feature_type, created_at,  updated_at, updated_by, created_by, district_id, workcat_id_plan, asset_id, pavcat_id, drainzone_id, nodetype_1, node_sys_top_elev_1, node_sys_elev_1, nodetype_2, node_sys_top_elev_2, node_sys_elev_2, parent_id, expl_id2, adate, adescript, visitability)
VALUES('-903', '-903', '-903', '-905', '-906', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'SIPHON', 'SIPHON-CC100', NULL, 'CONDUIT', 2, 1, 2, NULL, NULL, NULL, NULL, false, NULL, 3, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '', '1', 'SRID=25831;LINESTRING (418457.2828905013 4577982.440103301, 418460.72130524175 4577983.040095135)'::public.geometry, NULL, NULL, NULL, true, true, false, 2, NULL, 'ARC', '2024-08-23 12:10:22.028', '2024-08-23 12:10:22.098', 'postgres', 'postgres', NULL, NULL, NULL, 'Asphalt', NULL, 'CIRC_MANHOLE', 33.280, NULL, 'CIRC_MANHOLE', 33.180, NULL, NULL, NULL, NULL, NULL, 1);
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-903'), 1, 'INSERT: arc "-903" was inserted');

UPDATE arc SET y1 = 33.0000 WHERE arc_id = '-903';
SELECT is((SELECT y1 FROM arc WHERE arc_id = '-903'), 33.0000, 'UPDATE: arc "-903" was updated');

DELETE FROM arc WHERE arc_id = '-903';
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-903'), 0, 'DELETE: arc "-903" was deleted');


-- arc -> varc
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_highpoint
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type)
VALUES('-907', '-907', '-907', 33.270, NULL, 33.270, NULL, NULL, NULL, NULL, NULL, NULL, 'HIGHPOINT', 'JUNCTION', 'HIGH POINT-01', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418457.65211624536 4577980.478591539)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:01:08.000', 'postgres', '2024-08-23 12:01:08.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION');
INSERT INTO ve_node_highpoint
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type)
VALUES('-908', '-908', '-908', 33.270, NULL, 33.270, NULL, NULL, NULL, NULL, NULL, NULL, 'HIGHPOINT', 'JUNCTION', 'HIGH POINT-01', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418461.1136075948 4577981.078583373)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:01:16.000', 'postgres', '2024-08-23 12:01:16.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION');

INSERT INTO arc
(arc_id, code, sys_code, node_1, node_2, y1, y2, elev1, elev2, custom_y1, custom_y2, custom_elev1, custom_elev2, sys_elev1, sys_elev2, arc_type, arccat_id, matcat_id, epa_type, sector_id, state, state_type, annotation, observ, "comment", sys_slope, inverted_slope, custom_length, omzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, descript, link, verified, the_geom, label_x, label_y, label_rotation, publish, inventory, uncertain, expl_id, num_value, feature_type, created_at,  updated_at, updated_by, created_by, district_id, workcat_id_plan, asset_id, pavcat_id, drainzone_id, nodetype_1, node_sys_top_elev_1, node_sys_elev_1, nodetype_2, node_sys_top_elev_2, node_sys_elev_2, parent_id, expl_id2, adate, adescript, visitability)
VALUES('-904', '-904', '-904', '-907', '-908', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'VARC', 'VIRTUAL', NULL, 'VIRTUAL', 2, 1, 2, NULL, NULL, NULL, NULL, false, NULL, 3, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '', '1', 'SRID=25831;LINESTRING (418457.65211624536 4577980.478591539, 418461.1136075948 4577981.078583373)'::public.geometry, NULL, NULL, NULL, true, true, false, 2, NULL, 'ARC', '2024-08-23 12:11:35.356', '2024-08-23 12:11:35.424', 'postgres', 'postgres', NULL, NULL, NULL, 'Asphalt', NULL, 'HIGHPOINT', 33.270, NULL, 'HIGHPOINT', 33.270, NULL, NULL, NULL, NULL, NULL, 1);
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-904'), 1, 'INSERT: arc "-904" was inserted');

UPDATE arc SET y1 = 33.0000 WHERE arc_id = '-904';
SELECT is((SELECT y1 FROM arc WHERE arc_id = '-904'), 33.0000, 'UPDATE: arc "-904" was updated');

DELETE FROM arc WHERE arc_id = '-904';
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-904'), 0, 'DELETE: arc "-904" was deleted');


-- arc -> waccel
-- initial data is prepared before proceeding with the test
INSERT INTO ve_node_jump
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, prot_surface, accessibility, "name")
VALUES('-909', '-909', '-909', 33.270, NULL, 33.270, NULL, NULL, NULL, NULL, NULL, NULL, 'JUMP', 'WJUMP', 'JUMP-01', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418458.17133994785 4577978.678616038)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:01:28.000', 'postgres', '2024-08-23 12:01:28.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', 0.000, 0.000, NULL, false, NULL, NULL);
INSERT INTO ve_node_jump
(node_id, code, sys_code, top_elev, custom_top_elev, sys_top_elev, ymax, custom_ymax, sys_ymax, elev, custom_elev, sys_elev, node_type, sys_type, nodecat_id, matcat_id, epa_type, state, state_type, expl_id, macroexpl_id, sector_id, macrosector_id, drainzone_id, annotation, observ, "comment", omzone_id, macroomzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, district_id, streetname, postnumber, postcomplement, streetname2, postnumber2, postcomplement2, region_id, province_id, descript, svg, rotation, link, verified, the_geom, "label", label_x, label_y, label_rotation, publish, inventory, uncertain, xyz_date, unconnected, num_value, created_at, created_by, updated_at, updated_by, workcat_id_plan, asset_id, parent_id, arc_id, expl_id2, is_operative, adate, adescript, placement_type, inp_type, length, width, sander_depth, prot_surface, accessibility, "name")
VALUES('-910', '-910', '-910', 33.270, NULL, 33.270, NULL, NULL, NULL, NULL, NULL, NULL, 'JUMP', 'WJUMP', 'JUMP-01', NULL, 'JUNCTION', 1, 2, 2, 1, 2, 2, NULL, NULL, NULL, NULL, 3, NULL, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, '', '1', 'SRID=25831;POINT (418461.4828333389 4577979.197839739)'::public.geometry, NULL, NULL, NULL, NULL, true, true, false, NULL, false, NULL, '2024-08-23 12:01:40.000', 'postgres', '2024-08-23 12:01:40.000', 'postgres', NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, 'JUNCTION', 0.000, 0.000, NULL, false, NULL, NULL);

INSERT INTO arc
(arc_id, code, sys_code, node_1, node_2, y1, y2, elev1, elev2, custom_y1, custom_y2, custom_elev1, custom_elev2, sys_elev1, sys_elev2, arc_type, arccat_id, matcat_id, epa_type, sector_id, state, state_type, annotation, observ, "comment", sys_slope, inverted_slope, custom_length, omzone_id, soilcat_id, function_type, category_type, fluid_type, location_type, workcat_id, workcat_id_end, builtdate, enddate, ownercat_id, muni_id, postcode, streetaxis_id, postnumber, postcomplement, streetaxis2_id, postnumber2, postcomplement2, descript, link, verified, the_geom, label_x, label_y, label_rotation, publish, inventory, uncertain, expl_id, num_value, feature_type, created_at,  updated_at, updated_by, created_by, district_id, workcat_id_plan, asset_id, pavcat_id, drainzone_id, nodetype_1, node_sys_top_elev_1, node_sys_elev_1, nodetype_2, node_sys_top_elev_2, node_sys_elev_2, parent_id, expl_id2, adate, adescript, visitability)
VALUES('-905', '-905', '-905', '-909', '-910', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'WACCEL', 'WACCEL-CC020', NULL, 'CONDUIT', 2, 1, 2, NULL, NULL, NULL, NULL, false, NULL, 3, 'soil1', NULL, NULL, NULL, NULL, 'work1', NULL, '2024-08-23', NULL, 'owner1', 2, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '', '1', 'SRID=25831;LINESTRING (418458.17133994785 4577978.678616038, 418461.4828333389 4577979.197839739)'::public.geometry, NULL, NULL, NULL, true, true, false, 2, NULL, 'ARC', '2024-08-23 12:11:49.621', '2024-08-23 12:11:49.684', 'postgres', 'postgres', NULL, NULL, NULL, 'Asphalt', NULL, 'JUMP', 33.270, NULL, 'JUMP', 33.270, NULL, NULL, NULL, NULL, NULL, 1);
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-905'), 1, 'INSERT: arc "-905" was inserted');

UPDATE arc SET y1 = 33.0000 WHERE arc_id = '-905';
SELECT is((SELECT y1 FROM arc WHERE arc_id = '-905'), 33.0000, 'UPDATE: arc "-905" was updated');

DELETE FROM arc WHERE arc_id = '-905';
SELECT is((SELECT count(*)::integer FROM arc WHERE arc_id = '-905'), 0, 'DELETE: arc "-905" was deleted');

SELECT * FROM finish();

ROLLBACK;
