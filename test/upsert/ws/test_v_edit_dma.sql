/*
This file is part of Giswater 3
The program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
This version of Giswater is provided by Giswater Association
*/
BEGIN;

-- Suppress NOTICE messages
SET client_min_messages TO WARNING;

SET search_path = "SCHEMA_NAME", public, pg_catalog;

SELECT plan(6);

INSERT INTO v_edit_dma
(dma_id, "name", macrodma_id, expl_id, dma_type, descript, pattern_id, graphconfig, stylesheet, link, avg_press, effc, active, undelete, tstamp, insert_user, lastupdate, lastupdate_user, the_geom)
VALUES(-901, 'dma1-1d', NULL, 1, NULL, NULL, 'PTN-DMA-01-DEF', '{"use":[{"nodeParent":"113766", "toArc":[113906]}], "ignore":[], "forceClosed":[]}', '{"color":[251,181,174], "featureColor":"251,181,174"}', NULL, 30, NULL, true, NULL, '2024-02-21 12:08:16.880', 'postgres', NULL, NULL, 'SRID=25831;MULTIPOLYGON (((419194.61316627724 4576770.399179328, 419194.6598362386 4576769.953629146, 419194.38973924454 4576767.025545911, 419193.55359138723 4576764.206418283, 419192.18352535996 4576761.604583758, 419190.3321920317 4576759.320029375, 419188.07073710416 4576757.44054928, 419185.48606702185 4576756.038370837, 419182.6775092066 4576755.16737898, 419179.7529949602 4576754.861045434, 419176.82491172495 4576755.131142428, 419174.0057840976 4576755.967290285, 419171.40394957183 4576757.337356313, 419165.9938522016 4576760.90401556, 419163.7879399141 4576762.678242932, 419161.95466072566 4576764.835328746, 419160.5593114111 4576767.298443051, 419159.6515907893 4576769.979855936, 419159.2638295764 4576772.784062247, 419159.4098388475 4576775.6111832345, 419160.0844181212 4576778.360523991, 419161.2635405873 4576780.93415994, 419162.9052088813 4576783.240424669, 419164.9509509244 4576785.197174854, 419201.3464695487 4576813.952624451, 419259.3384593364 4576859.771060414, 419252.8073739664 4576866.130448861, 419252.8073739648 4576866.130448862, 419250.92192793905 4576867.966328044, 419249.02637734904 4576870.2143297745, 419247.60581261356 4576872.788940357, 419246.71482523874 4576875.591218951, 419246.38765536965 4576878.513475561, 419246.636875961 4576881.443409505, 419247.4529096051 4576884.268425064, 419248.8043965867 4576886.879958475, 419250.6394000191 4576889.177649974, 419252.8874017494 4576891.073200564, 419255.46201233176 4576892.493765299, 419258.2642909254 4576893.384752674, 419261.1865475355 4576893.711922543, 419264.1164814794 4576893.462701952, 419266.94149703864 4576892.6466683075, 419269.55303044966 4576891.295181326, 419271.8507219481 4576889.460177894, 419273.73616797384 4576887.624298711, 419273.7361679753 4576887.624298709, 419273.73616797547 4576887.624298709, 419281.88532746094 4576879.689374, 419281.8858570231 4576879.688745973, 419281.88649887784 4576879.6882332545, 419292.5112031606 4576869.340587349, 419294.34347424074 4576867.183350403, 419295.73789366917 4576864.720327259, 419296.64481460734 4576862.039211268, 419297.0319470883 4576859.235460744, 419296.88550766703 4576856.408900282, 419296.2107101651 4576853.660166596, 419295.0315800385 4576851.087125458, 419293.3900989762 4576848.7813872965, 419291.3447101864 4576846.825045493, 419219.94462044636 4576790.413109096, 419194.61316627724 4576770.399179328)))'::public.geometry);
SELECT is((SELECT count(*)::integer FROM v_edit_dma WHERE dma_id = -901), 1, 'INSERT: v_edit_dma -901 was inserted');
SELECT is((SELECT count(*)::integer FROM dma WHERE dma_id = -901), 1, 'INSERT: dma -901 was inserted');

UPDATE v_edit_dma SET descript = 'updated descript' WHERE dma_id = -901;
SELECT is((SELECT descript FROM v_edit_dma WHERE dma_id = -901), 'updated descript', 'UPDATE: v_edit_dma -901 was updated');
SELECT is((SELECT descript FROM dma WHERE dma_id = -901), 'updated descript', 'UPDATE: dma -901 was updated');

DELETE FROM v_edit_dma WHERE dma_id = -901;
SELECT is((SELECT count(*)::integer FROM v_edit_dma WHERE dma_id = -901), 0, 'DELETE: v_edit_dma -901 was deleted');
SELECT is((SELECT count(*)::integer FROM dma WHERE dma_id = -901), 0, 'DELETE: dma -901 was deleted');


SELECT * FROM finish();


ROLLBACK;